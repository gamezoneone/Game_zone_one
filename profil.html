<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profil Pemain - GameZone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@400;700&display=swap');

        /* Reset dan Dasar */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            width: 100%; /* Penting: Pastikan lebar 100% */
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            color: #e0e0e0; /* Warna teks umum */
            overflow-x: hidden; /* Mencegah scroll horizontal */
            position: relative; /* Untuk border neon body */

            /* Background lebih gelap untuk kontras neon */
            background-image: url('https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//E%20vamos%20de%20arte!!!.jpeg');
            background-size: cover; /* Memastikan gambar menutupi seluruh area */
            background-position: center center;
            background-attachment: fixed; /* Gambar tidak ikut discroll */
            background-repeat: no-repeat;
           /* background-color: #000000; /* Warna fallback jika gambar gagal dimuat */
            background-blend-mode: overlay; /* Menambahkan efek overlay gelap */
        }

        /* Neon Border Effect for Body/Main Container */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9); /* Background transparan agar gambar terlihat */
            z-index: -1; /* Pindahkan ke belakang konten */
            border: 2px solid #00ffff; /* Warna cyan/biru neon */
            box-shadow: 0 0 15px #00ffff, 0 0 25px #00ffff, 0 0 40px #00ffff; /* Efek glow */
        }

        /* Kontainer Utama */
        .container {
            width: 100%; /* MELEBAR PENUH SESUAI LAYAR */
            max-width: none; /* MENGHILANGKAN BATAS LEBAR */
            margin: 0; /* MENEMPEL PADA SISI ATAS DAN SAMPING */
            background: rgba(0,0,0,0.0); /* Hampir hitam transparan */
            border-radius: 0; /* Menghilangkan border-radius agar menempel */
            padding: 0; /* Menghilangkan padding utama agar konten menempel */
            box-shadow: none; /* Menghilangkan bayangan kontainer utama */
            border: none; /* Menghilangkan border utama */
            position: relative;
            animation: fadeIn 1s ease-out; /* Animasi masuk */
            display: flex; /* Untuk layout flex-direction column */
            flex-direction: column;
            min-height: 100vh; /* Pastikan container mengisi tinggi viewport */
            padding-bottom: 70px; /* Padding bawah untuk tombol WA dan refresh */
        }

        /* Animasi Fade In (jika diperlukan) */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animasi Border Neon */
        @keyframes neon-border-pulse {
            from { border-color: rgba(0, 255, 255, 0.6); box-shadow: 0 0 40px rgba(0, 255, 255, 0.4), 0 0 80px rgba(0, 255, 255, 0.2), inset 0 0 20px rgba(0, 255, 255, 0.1); }
            to { border-color: rgba(0, 200, 200, 0.8); box-shadow: 0 0 50px rgba(0, 255, 255, 0.6), 0 0 100px rgba(0, 255, 255, 0.3), inset 0 0 25px rgba(0, 255, 255, 0.2); }
        }


        /* Saldo di Pojok Kiri Atas - Akan disesuaikan agar tetap di dalam container */
        .saldo {
            position: absolute; /* Tetap absolut relatif terhadap container */
            top: 20px; /* Jarak dari atas container */
            left: 20px; /* Jarak dari kiri container */
            font-family: 'Orbitron', sans-serif; /* Font futuristik */
            font-size: 1em;
            font-weight: 700;
            color: gold; /* Neon hijau terang */
            background: linear-gradient(90deg, black 0%, #00bc 100%);
            padding: 10px 18px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.6); /* Glow neon hijau */
            z-index: 10;
            border: 1px solid rgba(57, 255, 20, 0.4);
        }

        /* Judul Utama */
        h2 {
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            color: #ffd700;
            
            animation: neon-glow 1.5s ease-in-out infinite alternate;
            margin-top: 30px; /* Jarak dari atas container */
            margin-bottom: 20px;
            line-height: 1.2;
            font-size: 3em; /* Ukuran default lebih besar */
        }
        .marquee-container {
            width: 100%;
            padding: 10px 0;
            background: linear-gradient(90deg, #222 0%, #00bc 100%);
            color: gold; /* Hijau neon */
            font-size: 1em;
            text-align: center;
            border-bottom: 2px solid #ff00ff; /* Border bawah */
            border-top: 2px solid #ff00ff; /* Border atas */
            box-shadow: 0 0 10px #00ff00; /* Glow hijau */
            margin-bottom: 2px; /* Jarak dengan elemen berikutnya */
        }
        .marquee-container marquee {
            padding: 0 10px; /* Padding di dalam marquee untuk menghindari teks menempel sisi */
        }

        /* Grup Tombol (Deposit, Penarikan, Riwayat) */
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 10px; /* Jarak antar tombol yang lebih kecil */
            margin-bottom: 2px;
            flex-wrap: wrap;
            padding: 0 20px; /* Padding agar tidak menempel sisi layar */
        }

        /* Tombol Umum */
        .btn {
         background: linear-gradient(90deg, #e000ff 0%, #00bcd4 100%);
            border: none;
            border-radius: 25px; /* Lebih kecil, ramping */
            padding: 10px 20px; /* Padding lebih kecil */
            font-size: 0.95em; /* Ukuran font sedikit lebih kecil */
            font-weight: 700;
            cursor: pointer;
            color: #0d0d1a; /* Warna teks gelap */
            box-shadow: 0 0 15px rgba(0, 188, 212, 0.6), 0 0 25px rgba(0, 188, 212, 0.4); /* Glow neon biru */
            transition: all 0.3s ease;
            flex: 1;
            min-width: 100px; /* Ukuran minimum tombol yang lebih kecil */
            max-width: 160px; /* Batasi lebar agar tetap sejajar */
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid gold;
        }

        .btn:hover {
            background: #39ff14; /* Neon hijau saat hover */
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.8), 0 0 30px rgba(57, 255, 20, 0.5);
            color: #0d0d1a;
            border-color: rgba(57, 255, 20, 1);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 0 10px rgba(0, 188, 212, 0.4);
        }

        /* Tabel */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 20px;
            background: rgba(10, 10, 30, 0.7); /* Background tabel lebih gelap */
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2), inset 0 0 10px rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            margin-left: 20px; /* Padding kiri-kanan untuk tabel */
            margin-right: 20px;
            width: calc(100% - 40px); /* Sesuaikan lebar dengan padding */
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1); /* Garis pemisah neon halus */
            color: #c0c0c0; /* Teks lebih terang */
        }

        th {
            background: #00bcd4; /* Header biru neon */
            color: #0d0d1a;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.9em;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }

        tr:last-child td {
            border-bottom: none;
        }

        .empty {
            color: #888;
            font-style: italic;
            text-align: center;
            padding: 20px 0;
        }

        /* Status dalam Tabel */
        .status-pending { color: #ffeb3b; /* Kuning neon */ font-weight: bold; }
        .status-approved { color: #39ff14; /* Hijau neon */ font-weight: bold; }
        .status-rejected { color: #ff4d4d; /* Merah neon */ font-weight: bold; }

        /* Efek Loading Tombol */
        .btn.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
            background: #00bcd4;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin-top: -10px;
            margin-left: -10px;
            border: 3px solid #e000ff; /* Warna loading neon ungu */
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* --- Modal Kustom (Popup) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9); /* Overlay lebih gelap */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: #1a0a2e; /* Ungu gelap */
            color: #e0e0e0;
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(224, 0, 255, 0.7), inset 0 0 15px rgba(224, 0, 255, 0.3); /* Glow ungu */
            width: 90%;
            max-width: 480px; /* Sedikit lebih lebar */
            transform: translateY(-50px) scale(0.9); /* Efek masuk lebih dramatis */
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.4s ease-out; /* Animasi bounce */
            position: relative;
            border: 2px solid rgba(224, 0, 255, 0.8);
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .modal-content h2 {
            font-family: 'Orbitron', sans-serif;
            color: #39ff14; /* Hijau neon untuk judul modal */
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            text-shadow: 0 0 15px rgba(57, 255, 20, 0.8);
            border-bottom: none;
            padding-bottom: 0;
            background: none; /* Hapus background dari h2 di modal */
            margin-left: 0; /* Reset margin h2 di modal */
            margin-right: 0;
            padding: 0;
        }

        .modal-content label {
            display: block;
            margin-bottom: 8px;
            color: #00bcd4; /* Label biru neon */
            font-size: 0.95em;
            text-shadow: 0 0 5px rgba(0, 188, 212, 0.3);
        }

        .modal-content input[type="text"],
        .modal-content input[type="email"],
        .modal-content input[type="number"],
        .modal-content select {
            width: 100%;
            padding: 12px 18px;
            margin-bottom: 20px; /* Jarak antar input lebih besar */
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.4); /* Border neon transparan */
            background-color: rgba(0, 0, 0, 0.6); /* Background input lebih gelap */
            color: #e0e0e0;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .modal-content input:focus,
        .modal-content select:focus {
            outline: none;
            border-color: #39ff14; /* Border hijau neon saat fokus */
            box-shadow: 0 0 0 4px rgba(57, 255, 20, 0.3), 0 0 15px rgba(57, 255, 20, 0.5);
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content input::placeholder {
            color: #888;
        }

        .modal-content input[readonly] {
            background-color: rgba(0, 0, 0, 0.4);
            border-color: rgba(0, 255, 255, 0.2);
            cursor: default;
        }

        /* --- Penyesuaian Baru/Modifikasi --- */
        .input-group-with-copy { /* Kelas baru untuk membungkus label, input, dan button copy */
            display: flex;
            align-items: center;
            margin-bottom: 20px; /* Jarak antar grup */
            gap: 10px; /* Jarak antara input dan button */
        }

        .input-group-with-copy label {
            margin-bottom: 0; /* Hapus margin-bottom default */
            flex-shrink: 0; /* Pastikan label tidak menyusut */
            white-space: nowrap; /* Pastikan teks label tidak pecah baris */
            padding-right: 5px; /* Sedikit padding agar tidak terlalu mepet */
        }
        .input-group-with-copy input[type="text"] {
            flex-grow: 1; /* Biarkan input mengambil sisa ruang yang tersedia */
            margin-bottom: 0; /* Hapus margin-bottom default */
        }

        .btn-copy {
            background: #e000ff !important;
            color: white !important;
            border-radius: 8px !important;
            padding: 8px 15px !important;
            font-size: 0.9em !important;
            box-shadow: 0 0 10px rgba(224, 0, 255, 0.6) !important;
            flex-shrink: 0; /* Penting: mencegah button menyusut */
            border: 1px solid rgba(224, 0, 255, 0.8);
            min-width: 80px; /* Minimum width untuk tombol Salin */
            text-align: center;
            display: flex; /* Untuk ikon dan teks sejajar */
            align-items: center;
            justify-content: center;
            gap: 5px; /* Jarak antara ikon dan teks */
        }
        .btn-copy:hover {
            background: #39ff14 !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.8) !important;
            border-color: rgba(57, 255, 20, 1);
        }

        /* Tombol Primary dan Secondary dalam Modal */
        .modal-content button.primary {
            background: linear-gradient(90deg, #39ff14 0%, #00bcd4 100%); /* Gradien hijau ke biru */
            border: 2px solid #fff;
            padding: 12px 25px;
            border-radius: 10px;
            color: #0d0d1a;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.6);
            margin-top: 15px; /* Jarak dari input terakhir */
            width: 100%; /* Memastikan tombol modal melebar penuh */
        }

        .modal-content button.primary:hover {
            background: linear-gradient(90deg, #00bcd4 0%, #39ff14 100%);
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.8);
            transform: translateY(-2px) scale(1.01);
        }

        .modal-content button.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #e0e0e0;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px; /* Jarak dari tombol di atasnya */
            width: 100%; /* Memastikan tombol modal melebar penuh */
        }

        .modal-content button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #39ff14;
            border-color: #39ff14;
        }

        #form-qris {
            text-align: center;
            margin: 25px 0;
        }

        #gambar-qris {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            border: 3px solid #39ff14; /* Border hijau neon */
            box-shadow: 0 0 25px rgba(57, 255, 20, 0.7); /* Glow hijau */
        }

        /* --- Game Grid --- */
        .game-grid-section {
            margin-top: -10px;
            padding: 0 20px; /* Padding agar tidak menempel sisi layar */
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Ukuran lebih kecil: min 100px */
            gap: 15px; /* Jarak antar game lebih kecil */
            padding: 10px;
            border-radius: 15px;
            background: rgba(0,0,0,0.9);
            box-shadow: inset 0 0 20px rgba(0, 255, 255, 0.1);
            border: 1px solid gold;
        }

        .game-item {
            background: rgba(10, 10, 30, 0.8); /* Background item game lebih gelap */
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(224, 0, 255, 0.3); /* Glow ungu halus */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: block;
            position: relative;
            padding-top: 100%; /* Rasio aspek 1:1, untuk gambar persegi */
            height: 0;
            border: 1px solid gold;
        }

        .game-item:hover {
            transform: translateY(-5px) scale(1.05); /* Efek hover lebih menonjol */
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.6), 0 0 40px rgba(0, 255, 255, 0.4); /* Glow biru kuat */
            border-color: rgba(0, 255, 255, 0.8);
        }

        .game-item a {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block; /* Penting untuk link */
            text-decoration: none;
        }

        .game-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px; /* Ikuti border radius parent */
            transition: transform 0.3s ease; /* Transisi untuk gambar saat hover */
        }

        .game-item:hover img {
            transform: scale(1.05); /* Gambar sedikit membesar saat hover */
        }

        /* Tombol refresh di bawah */
        .refresh-btn-wrapper {
            position: fixed;
            bottom: 10px;
            left: 71%;
            transform: translateX(-50%);
            z-index: 999; /* Di atas elemen lain tapi di bawah WA */
            width: 100%;
            padding: 0 20px; /* Padding agar tidak menempel sisi */
        }

        .refresh-btn-wrapper button {
            background: linear-gradient(90deg, #e000ff 0%, #00bcd4 100%);
            border: 2px solid #39ff14;
            color: #fff;
            padding: 5px 10px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(224, 0, 255, 0.6);
            width: 50%;
            margin: 0 auto;
            display: block;
        }

        .refresh-btn-wrapper button:hover {
            background: linear-gradient(90deg, #00bcd4 0%, #e000ff 100%);
            box-shadow: 0 0 30px rgba(224, 0, 255, 0.8), 0 0 40px rgba(0, 188, 212, 0.8);
            transform: translateY(-3px) scale(1.02);
        }

        /* WhatsApp Button */
        .whatsapp-button {
            position: fixed;
            bottom: 50px;
            right: 15px;
            z-index: 1; /* Pastikan di atas semua */
        }
        .whatsapp-button img {
          im
            width: 30px; /* Ukuran ikon WA */
            height: 30px;
            border-radius: 100%;
            box-shadow: 0 0 99px rgba(37, 211, 102, 0.8), 0 0 25px rgba(37, 211, 102, 0.5); /* Glow hijau WA */
            transition: transform 0s ease;
        }
        .whatsapp-button img:hover {
            transform: scale(1.1);
        }


        /* Responsif untuk Mobile */
        @media (max-width: 768px) {
            .container {
                padding-bottom: 0px; /* Sesuaikan padding bawah untuk tombol di mobile */
            }
            .saldo {
                font-size: 0.9em;
                top: 15px;
                left: 15px;
                padding: 8px 15px;
                border-radius: 12px;
            }
            h1 {
                font-size: 2.2em; /* Sesuaikan ukuran judul utama */
                margin-top: 25px;
            }
            .marquee-container {
                padding: 8px 0;
                font-size: 0.9em;
            }
            .btn-group {
                gap: 8px; /* Jarak lebih kecil */
                padding: 0 15px;
            }
            .btn {
                padding: 9px 15px;
                font-size: 0.85em;
                border-radius: 5px;
                max-width: 140px; /* Batasi lagi di tablet */
            }
            
            table {
                padding: 0 15px;
                width: calc(100% - 30px); /* Sesuaikan lebar dengan padding */
                margin-left: 15px;
                margin-right: 15px;
            }
            th, td {
                padding: 10px;
                font-size: 0.8em;
            }
            .modal-content {
                padding: 25px;
                border-radius: 15px;
            }
            .modal-content h2 {
                font-size: 1.8em;
            }
            .modal-content button {
                padding: 10px 20px;
                font-size: 0.9em;
            }
            .btn-copy {
                font-size: 0.8em !important; /* Ukuran font lebih kecil untuk salin */
                padding: 6px 10px !important; /* Padding lebih kecil */
                min-width: 60px;
            }
            .input-group-with-copy {
                flex-direction: column; /* Ubah ke kolom pada layar yang lebih sempit */
                align-items: flex-start;
                gap: 5px;
            }
            .input-group-with-copy label,
            .input-group-with-copy input[type="text"],
            .btn-copy {
                width: 100%; /* Lebar penuh */
            }

            .game-grid-section {
                padding: 0 15px; /* Padding agar tidak menempel sisi layar */
            }
            .game-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); /* Lebih kecil lagi untuk tablet */
                gap: 10px;
            }
            .refresh-btn-wrapper {
                padding: 0 15px;
            }
            .refresh-btn-wrapper button {
                max-width: 250px;
            }
            .whatsapp-button img {
                width: 45px;
                height: 45px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding-bottom: 0px; /* Sesuaikan padding bawah untuk tombol di mobile sangat kecil */
            }
            .saldo {
                font-size: 0.8em;
                top: 0px;
                left: 10px;
                padding: 6px 12px;
            }
            h1 {
                font-size: 0.8em; /* Lebih kecil lagi */
                margin-top: 20px;
            }
            .marquee-container {
                padding: 6px 0;
                font-size: 0.8em;
            }
            .btn-group {
                gap: 6px;
                padding: 0 10px;
            }
            .btn {
                width: 48%; /* Dua kolom per baris */
                padding: 7px 10px;
                font-size: 0.75em;
            }

            table {
                padding: 0 10px;
                width: calc(100% - 20px);
                margin-left: 10px;
                margin-right: 10px;
            }
            th, td {
                padding: 8px;
                font-size: 0.75em;
            }
            .modal-content {
                padding: 20px;
                border-radius: 12px;
            }
            .modal-content h2 {
                font-size: 1.5em;
            }
            .modal-content input,
            .modal-content select {
                font-size: 0.85em;
                padding: 10px 12px;
            }
            .modal-content button {
                padding: 8px 15px;
                font-size: 0.8em;
            }
            .btn-copy {
                font-size: 0.7em !important;
                padding: 5px 8px !important;
                min-width: 50px;
            }
            .game-grid {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); /* Paling kecil untuk ponsel */
                gap: 6px;
            }
            .refresh-btn-wrapper {
                padding: 0 10px;
            }
            .refresh-btn-wrapper button {
                max-width: 200px;
                font-size: 1em;
                padding: 10px 20px;
            }
            .whatsapp-button img {
                width: 35px;
                height: 35px;
            }
            /* Gaya untuk Gambar Judul "PILIH GAME" */
.game-section-title-image {
    display: block; /* Agar gambar mengambil baris penuh */
    max-width: 90%; /* Batasi lebar gambar agar tidak terlalu besar */
    height: auto;
    margin: 20px auto 25px auto; /* Pusatkan gambar dan berikan margin atas/bawah */
    border-radius: 10px; /* Sudut sedikit membulat */
    border: 2px solid #00ffff; /* Border neon biru */
    box-shadow: 0 0 15px #00ffff, 0 0 25px #00ffff, 0 0 40px #00ffff; /* Efek glow neon */
    animation: neon-glow-image 1.5s ease-in-out infinite alternate; /* Animasi glow */
}

@keyframes neon-glow-image {
    from {
        box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
        border-color: rgba(0, 255, 255, 0.7);
    }
    to {
        box-shadow: 0 0 20px #00ffff, 0 0 5px #00ffff, 0 0 0px #00ffff;
        border-color: #00ffff;
    }
}

/* Sesuaikan media queries jika perlu untuk ukuran gambar */
@media (max-width: 768px) {
    .game-section-title-image {
        max-width: 95%; /* Lebih lebar sedikit di mobile */
        margin: 15px auto 20px auto;
        box-shadow: 0 0 10px #00ffff, 0 0 15px #00ffff;
    }
}

@media (max-width: 480px) {
    .game-section-title-image {
        max-width: 98%; /* Hampir penuh di layar sangat kecil */
        margin: 10px auto 15px auto;
        box-shadow: 0 0 8px #00ffff, 0 0 12px #00ffff;
    }
}
 </style>
</head>
<body>
<audio id="background-music" loop autoplay>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <audio id="click-sound">
    <source src="https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/music//mixkit-mechanical-crate-pick-up-3154%20(1).mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <div class="container">
    <div class="saldo" id="saldo-display">Saldo: Rp.0</div>
    <h1></h1>
  <div class="marquee-container">
 <marquee> ⚠️•penting untuk mengecek rekening/nomor deposit bandar dan nomor penerima penarikan ('nomor anda') agar proses berjalan lancar. Game Zone tidak akan memproses deposit ke nomor lain dan tidak memproses withdraw kembali jika ada kesalah input nomor penerima withdraw•⚠️</marquee>
    </div>

    <div class="btn-group">
      <button class="btn" id="btn-deposit">Deposit</button>
      <button class="btn" id="btn-withdraw">Penarikan</button>
      <button class="btn" id="btn-history">Riwayat</button> </div>

    <div id="section-deposit-history" style="display:none;">
      <h2>Riwayat Deposit</h2>
      <table id="riwayat-deposit">
        <thead><tr><th>Tanggal</th><th>Jumlah (Rp)</th><th>Status</th></tr></thead>
        <tbody><tr><td colspan="3" class="empty">Memuat data...</td></tr></tbody>
      </table>
    </div>

    <div id="section-withdraw-history" style="display:none;">
      <h2>Riwayat Penarikan</h2>
      <table id="riwayat-penarikan">
        <thead><tr><th>Tanggal</th><th>Jumlah (Rp)</th><th>Status</th></tr></thead>
        <tbody><tr><td colspan="3" class="empty">Memuat data...</td></tr></tbody>
      </table>
    </div>
    
<div class="game-grid-section">
  <img src="https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//wso138-jackpot.gif" alt="__" class="game-section-title-image">
  <div class="game-grid" id="game-display-grid">
    </div>
</div>
     
    <div class="refresh-btn-wrapper">
        <button onclick="location.reload();">Refresh</button>
    </div>
     
        <div id="modal-deposit" class="modal-overlay">
    <div class="modal-content">
      <h2>DEPOSIT VIA DANA</h2>
      <label for="dep-nama">Nama Penerima:</label>
      <input type="text" id="dep-nama" placeholder="Nama" readonly />

      <label for="dep-email">Email Pemain:</label>
      <input type="email" id="dep-email" placeholder="Email" readonly />

      <div class="input-group-with-copy"> <label for="dep-nomor">Nomor Tujuan:</label> <input type="text" id="dep-nomor" placeholder="Nomor" readonly /> <button class="btn-copy" data-target="dep-nomor">
          <i class="fas fa-copy"></i> Salin nomor
        </button>
      </div>

      <div style="text-align:center; margin: 25px 0;">
        <button class="secondary" id="btn-qris">deposit via Qris</button>
        <button class="secondary" id="btn-kembali-ewallet" style="display:none;">Kembali eWallet</button>
      </div>

      <div id="form-qris" style="display:none;">
        <img src="" alt="QRIS" id="gambar-qris" />
      </div>

      <label for="dep-jumlah">Jumlah (Rp):</label>
      <input type="number" id="dep-jumlah" placeholder="Contoh: 50000" />

  <button class="primary" id="dep-submit">Kirim</button>
  <button class="secondary" onclick="closeModal('modal-deposit')">Batal</button>
</div>
 </div>
     
  <div id="modal-withdraw" class="modal-overlay">
    <div class="modal-content">
      <h2>PENARIKAN DANA</h2>
      <label for="with-nama">Nama Penerima:</label>
      <input type="text" id="with-nama" placeholder="Nama Lengkap" />

      <label for="with-email">Email:</label>
      <input type="email" id="with-email" placeholder="Email" readonly />

      <label for="with-metode">Metode Penarikan:</label>
      <select id="with-metode">
        <option value="">Pilih e-Wallet/Bank</option>
        <option value="DANA">DANA</option>
        <option value="OVO">OVO</option>
        <option value="GoPay">GoPay</option>
        <option value="Bank">Transfer Bank</option>
      </select>

      <label for="with-nomor">No. Rekening/Ponsel:</label>
      <input type="text" id="with-nomor" placeholder="Nomor Rekening/Ponsel" />

      <label for="with-bank" id="label-bank" style="display:none;">Nama Bank:</label>
      <input type="text" id="with-bank" placeholder="Contoh: BCA / Mandiri" style="display:none;" />

      <label for="with-jumlah">Jumlah (Rp):</label>
      <input type="number" id="with-jumlah" placeholder="Contoh: 100000" />


  <button class="primary" id="with-submit">Kirim</button>
  <button class="secondary" onclick="closeModal('modal-withdraw')">Batal</button>
     </div>
    </div>
  </div>

  <div id="modal-history" class="modal-overlay">
    <div class="modal-content">
      <h2>RIWAYAT TRANSAKSI</h2>
      <div id="history-content">
        <h3>Riwayat Deposit</h3>
        <table id="riwayat-deposit-modal">
          <thead><tr><th>Tanggal</th><th>Jumlah (Rp)</th><th>Status</th></tr></thead>
          <tbody><tr><td colspan="3" class="empty">Memuat data...</td></tr></tbody>
        </table>

        <h3>Riwayat Penarikan</h3>
        <table id="riwayat-penarikan-modal">
          <thead><tr><th>Tanggal</th><th>Jumlah (Rp)</th><th>Status</th></tr></thead>
          <tbody><tr><td colspan="3" class="empty">Memuat data...</td></tr></tbody>
        </table>
      </div>
      <div class="modal-buttons">
        <button class="secondary" onclick="closeModal('modal-history')">Tutup</button>
      </div>
    </div>
  </div>
  
<a href="https://wa.me/628892l37079" target="_blank" class="whatsapp-button">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" 
       alt="WhatsApp">
</a>


  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const SUPABASE_URL = 'https://vqmfachxnjyxwuavpgds.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxbWZhY2h4bmp5eHd1YXZwZ2RzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0MDYxNDAsImV4cCI6MjA2Mzk4MjE0MH0.Bzr8mUiEl8MzRWpVQ3_59eFxKk0EWZ3ca-4IEcpGLkk';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let uid = localStorage.getItem('uid');
    let currentSaldo = 0; // Tambahkan variabel untuk menyimpan saldo saat ini

    const backgroundMusic = document.getElementById('background-music');
    const clickSound = document.getElementById('click-sound');

    // Autoplay background music on first user interaction
    document.addEventListener('click', () => {
        if (backgroundMusic.paused) {
            backgroundMusic.play().catch(e => console.log("Autoplay blocked:", e));
        }
    }, { once: true });

    // Play click sound on button clicks
    document.querySelectorAll('.btn, .modal-content button, .game-item').forEach(button => {
        button.addEventListener('click', () => {
            clickSound.currentTime = 0;
            clickSound.play().catch(e => console.log("Click sound play blocked:", e));
        });
    });

    async function getCurrentUserEmail() {
        const { data: { user }, error } = await supabase.auth.getUser();
        if (error) {
            console.error('Error fetching user from Supabase auth:', error.message);
            return null;
        }

        if (user && uid !== user.id) {
            uid = user.id;
            localStorage.setItem('uid', user.id);
        }
        return user ? user.email : null;
    }

    document.addEventListener('DOMContentLoaded', () => {
        getCurrentUserEmail().then(() => {
            loadProfile();
            loadGames();
        }).catch(err => {
            console.error("Failed to initialize user session:", err);
            showModal('alert-modal', 'Sesi Pengguna Tidak Valid', 'Sesi pengguna tidak valid. Silakan login kembali.', () => {
                window.location.href = 'login.html';
            });
        });

        // Copy button functionality
        document.querySelectorAll('.btn-copy').forEach(button => {
            button.addEventListener('click', (event) => {
                const targetId = event.currentTarget.dataset.target;
                const inputElement = document.getElementById(targetId);
                if (inputElement) {
                    inputElement.select();
                    inputElement.setSelectionRange(0, 99999);
                    try {
                        navigator.clipboard.writeText(inputElement.value)
                            .then(() => {
                                showModal('success-modal', 'Berhasil Disalin!', 'Nomor berhasil disalin: ' + inputElement.value);
                            })
                            .catch(err => {
                                console.error('Gagal menyalin teks: ', err);
                                showModal('error-modal', 'Gagal!', 'Gagal menyalin nomor. Silakan salin manual.');
                            });
                    } catch (err) {
                        // Fallback for older browsers
                        document.execCommand('copy');
                        showModal('success-modal', 'Berhasil Disalin!', 'Nomor berhasil disalin: ' + inputElement.value);
                    }
                }
            });
        });

        // Withdraw method change listener
        document.getElementById('with-metode').addEventListener('change', function() {
            const selectedMethod = this.value;
            const bankInput = document.getElementById('with-bank');
            const bankLabel = document.getElementById('label-bank');
            if (selectedMethod === 'Bank') {
                bankInput.style.display = 'block';
                bankLabel.style.display = 'block';
                bankInput.setAttribute('required', 'true');
            } else {
                bankInput.style.display = 'none';
                bankLabel.style.display = 'none';
                bankInput.removeAttribute('required');
                bankInput.value = '';
            }
        });
    });

    // Load user profile data (saldo, total_deposit, first_deposit)
    async function loadProfile() {
        if (!uid) {
            console.warn('UID tidak ditemukan. Tidak dapat memuat profil pengguna.');
            document.getElementById('saldo-display').textContent = 'Saldo: Rp.0 (Harap Login)';
            document.querySelector('#riwayat-deposit-modal tbody').innerHTML = '<tr><td colspan="3" class="empty">Silakan login untuk melihat riwayat.</td></tr>';
            document.querySelector('#riwayat-penarikan-modal tbody').innerHTML = '<tr><td colspan="3" class="empty">Silakan login untuk melihat riwayat.</td></tr>';
            return;
        }

        const { data: userData, error: userError } = await supabase
            .from('users_data')
            .select('saldo, total_deposit, first_deposit')
            .eq('user_id', uid)
            .single();

        if (userError && userError.code !== 'PGRST116') {
            console.error('Error memuat data profil:', userError.message);
            showModal('error-modal', 'Error', 'Gagal memuat data profil: ' + userError.message);
            document.getElementById('saldo-display').textContent = `Saldo: Rp.0 (Error)`;
            return;
        } else if (userError && userError.code === 'PGRST116') {
            console.warn('Pengguna baru, membuat entri saldo awal...');
            document.getElementById('saldo-display').textContent = `Saldo: Rp.0 (Baru)`;
            currentSaldo = 0;
            const { error: insertError } = await supabase
                .from('users_data')
                .insert([{ user_id: uid, saldo: 0, total_deposit: 0, first_deposit: false }]);

            if (insertError) {
                console.error('Error saat membuat entri saldo awal:', insertError.message);
                showModal('error-modal', 'Error Inisialisasi', 'Gagal membuat entri saldo awal. Cek log.');
                document.getElementById('saldo-display').textContent = `Saldo: Rp.0 (Error Inisialisasi)`;
            }

        } else {
            currentSaldo = userData.saldo ?? 0;
            document.getElementById('saldo-display').textContent = `Saldo: Rp.${currentSaldo.toLocaleString('id-ID')}`;
        }
    }

    // Load deposit/withdrawal history
    async function loadHistory(tableId, tableName) {
        const isDeposit = tableName === 'deposit_requests';
        const tableBody = document.querySelector(`#${tableId} tbody`);
        tableBody.innerHTML = '<tr><td colspan="3" class="empty">Memuat data...</td></tr>';

        const { data, error } = await supabase
            .from(tableName)
            .select('created_at, amount, status')
            .eq('user_id', uid)
            .order('created_at', { ascending: false });
        if (error) {
            console.error(`Error fetching ${tableName} history:`, error.message);
            tableBody.innerHTML = `<tr><td colspan="3" class="empty">Gagal memuat riwayat ${isDeposit ? 'deposit' : 'penarikan'}.</td></tr>`;
        } else if (!data || data.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="3" class="empty">Belum ada riwayat ${isDeposit ? 'deposit' : 'penarikan'}.</td></tr>`;
        } else {
            tableBody.innerHTML = '';
            data.forEach(row => {
                const date = new Date(row.created_at).toLocaleString('id-ID');
                const statusClass = `status-${row.status}`;
                tableBody.innerHTML += `<tr><td>${date}</td><td>Rp.${row.amount.toLocaleString('id-ID')}</td><td class="${statusClass}">${row.status.charAt(0).toUpperCase() + row.status.slice(1)}</td></tr>`;
            });
        }
    }

    // Generic modal handler
    function showModal(modalId, title, message, callback = null) {
        let modalElement;

        if (!document.getElementById('custom-alert-modal') && (modalId === 'alert-modal' || modalId === 'success-modal' || modalId === 'error-modal')) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = `
                <div id="custom-alert-modal" class="modal-overlay">
                    <div class="modal-content">
                        <h2 id="custom-alert-title" style="font-family: 'Orbitron', sans-serif;"></h2>
                        <p id="custom-alert-message" style="text-align: center; margin-bottom: 25px; color: #ccc;"></p>
                        <div class="modal-buttons">
                            <button class="primary" id="custom-alert-ok-btn">OK</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(tempDiv.firstElementChild);
        }
        if (modalId === 'alert-modal' || modalId === 'success-modal' || modalId === 'error-modal') {
            modalElement = document.getElementById('custom-alert-modal');
            document.getElementById('custom-alert-title').textContent = title;
            document.getElementById('custom-alert-message').textContent = message;
            const okBtn = document.getElementById('custom-alert-ok-btn');
            okBtn.onclick = () => {
                closeModal('custom-alert-modal');
                if (callback) callback();
            };
            if (modalId === 'success-modal') {
                document.getElementById('custom-alert-title').style.color = '#39ff14';
                document.getElementById('custom-alert-title').style.textShadow = '0 0 10px rgba(57, 255, 20, 0.6)';
            } else if (modalId === 'error-modal') {
                document.getElementById('custom-alert-title').style.color = '#ff4d4d';
                document.getElementById('custom-alert-title').style.textShadow = '0 0 10px rgba(255, 77, 77, 0.6)';
            } else {
                document.getElementById('custom-alert-title').style.color = '#ffeb3b';
                document.getElementById('custom-alert-title').style.textShadow = '0 0 10px rgba(255, 235, 59, 0.6)';
            }

        } else {
            modalElement = document.getElementById(modalId);
        }

        if (modalElement) {
            modalElement.classList.add('active');
        }
    }

    // Close modal handler
    function closeModal(modalId) {
        const modalElement = document.getElementById(modalId);
        if (modalElement) {
            modalElement.classList.remove('active');
            if (modalId === 'modal-deposit') {
                document.getElementById('dep-jumlah').value = '';
                document.getElementById('form-qris').style.display = 'none';
                document.getElementById('btn-kembali-ewallet').style.display = 'none';
            } else if (modalId === 'modal-withdraw') {
                // Reset withdrawal form fields
                document.getElementById('with-nama').value = '';
                document.getElementById('with-metode').value = '';
                document.getElementById('with-nomor').value = '';
                document.getElementById('with-jumlah').value = '';
                document.getElementById('with-bank').style.display = 'none';
                document.getElementById('label-bank').style.display = 'none';
            }
        }
    }

    // Deposit button logic
    document.getElementById('btn-deposit').onclick = async () => {
        if (!uid) { showModal('alert-modal', 'Login Diperlukan', 'Anda harus login untuk melakukan deposit.'); return; }
        showModal('modal-deposit');
        const userEmail = await getCurrentUserEmail();
        if (userEmail) {
            document.getElementById('dep-email').value = userEmail;
        }

        const { data, error } = await supabase
            .from('deposit_config')
            .select('*')
            .eq('metode', 'eWallet')
            .single();

        if (error || !data) {
            showModal('error-modal', 'Error', 'Gagal mengambil data eWallet.');
            return;
        }

        document.getElementById('dep-nama').value = data.nama;
        document.getElementById('dep-nomor').value = data.nomor;
        document.getElementById('dep-submit').dataset.metode = 'eWallet';
    };

    document.getElementById('btn-qris').onclick = async () => {
        const { data, error } = await supabase
            .from('deposit_config')
            .select('*')
            .eq('metode', 'QRIS')
            .single();

        if (error || !data) {
            showModal('error-modal', 'Error', 'Gagal mengambil data QRIS.');
            return;
        }

        document.getElementById('form-qris').style.display = 'block';
        document.getElementById('gambar-qris').src = data.qris_url;
        document.getElementById('dep-submit').dataset.metode = 'QRIS';
        document.getElementById('btn-kembali-ewallet').style.display = 'inline-block';
    };

    document.getElementById('btn-kembali-ewallet').onclick = async () => {
        const { data, error } = await supabase
            .from('deposit_config')
            .select('*')
            .eq('metode', 'eWallet')
            .single();

        if (error || !data) {
            showModal('error-modal', 'Error', 'Gagal mengambil data eWallet.');
            return;
        }

        document.getElementById('form-qris').style.display = 'none';
        document.getElementById('dep-nama').value = data.nama;
        document.getElementById('dep-nomor').value = data.nomor;
        document.getElementById('dep-submit').dataset.metode = 'eWallet';
        document.getElementById('btn-kembali-ewallet').style.display = 'none';
    };

    document.getElementById('dep-submit').onclick = async () => {
        if (!uid) { showModal('alert-modal', 'Login Diperlukan', 'Anda harus login untuk melakukan deposit.'); return; }
        const nama = document.getElementById('dep-nama').value;
        const email = document.getElementById('dep-email').value;
        const nomor = document.getElementById('dep-nomor').value;
        const jumlah = document.getElementById('dep-jumlah').value;
        const metode = document.getElementById('dep-submit').dataset.metode;

        if (!nama || !nomor || !jumlah || !email) {
            showModal('alert-modal', 'Peringatan', 'Lengkapi semua kolom.');
            return;
        }
        const depositTableBody = document.querySelector('#riwayat-deposit-modal tbody');
        const now = new Date();
        const dateString = now.toLocaleString('id-ID');
        const tempId = `temp-${Date.now()}`;
        const newRowHTML = `<tr class="pending-item" data-id="${tempId}"><td>${dateString}</td><td>Rp${parseInt(jumlah).toLocaleString('id-ID')}</td><td class="status-pending">Pending</td></tr>`;

        if (depositTableBody.querySelector('.empty')) {
            depositTableBody.innerHTML = '';
        }
        depositTableBody.insertAdjacentHTML('afterbegin', newRowHTML);


        const { error } = await supabase.from('deposit_requests').insert([
            { user_id: uid, nama, metode, amount: parseInt(jumlah), status: 'pending', email: email }
        ]);

        if (error) {
            console.error(error);
            showModal('error-modal', 'Gagal!', 'Gagal kirim deposit. Silakan coba lagi.');
            const tempRow = depositTableBody.querySelector(`[data-id="${tempId}"]`);
            if (tempRow) {
                tempRow.remove();
            }
        } else {
            showModal('success-modal', 'Berhasil!', 'Permintaan deposit dikirim.');
            closeModal('modal-deposit');
            loadProfile();
            loadHistory('riwayat-deposit-modal', 'deposit_requests');
        }
    };

    // --- MODIFIKASI FITUR PENARIKAN (WITHDRAWAL) DI BAWAH INI ---
    document.getElementById('btn-withdraw').onclick = async () => {
        if (!uid) { showModal('alert-modal', 'Login Diperlukan', 'Anda harus login untuk melakukan penarikan.'); return; }
        showModal('modal-withdraw');
        const userEmail = await getCurrentUserEmail();
        if (userEmail) {
            // Asumsi ada input dengan id='with-email' di modal withdraw Anda
            const withEmailInput = document.getElementById('with-email');
            if (withEmailInput) {
                withEmailInput.value = userEmail;
            } else {
                console.warn("Input 'with-email' tidak ditemukan di DOM. Pastikan ada.");
                // Jika tidak ada input with-email, Anda mungkin perlu menyimpannya di variabel lain
                // atau menyesuaikan struktur bankAccountInfo di with-submit.
            }
        }
        document.getElementById('with-jumlah').setAttribute('max', currentSaldo);
    };

    document.getElementById('with-submit').onclick = async () => {
        if (!uid) { showModal('alert-modal', 'Login Diperlukan', 'Anda harus login untuk melakukan penarikan.'); return; }

        // Mengambil nilai input dan membersihkan spasi awal/akhir
        const nama = document.getElementById('with-nama').value.trim();
        // Pastikan ada input dengan ID 'with-email' di HTML modal penarikan Anda
        const emailInput = document.getElementById('with-email');
        const email = emailInput ? emailInput.value.trim() : ''; // Ambil email, pastikan tidak null
        const metode = document.getElementById('with-metode').value;
        const nomor = document.getElementById('with-nomor').value.trim();
        const bank = document.getElementById('with-bank').value.trim();
        const jumlahInput = document.getElementById('with-jumlah').value; // Ambil sebagai string dulu
        const submitButton = document.getElementById('with-submit');

        // --- Frontend Validation (lebih robust) ---
        if (!nama || !metode || !nomor || !jumlahInput) {
            showModal('alert-modal', 'Peringatan', 'Lengkapi semua kolom yang wajib diisi.');
            return;
        }

        if (metode === 'Bank' && !bank) {
            showModal('alert-modal', 'Peringatan', 'Nama Bank harus diisi untuk metode Transfer Bank.');
            return;
        }
        const jumlah = parseInt(jumlahInput); // Parse integer setelah validasi string tidak kosong
        if (isNaN(jumlah) || jumlah <= 0) {
            showModal('alert-modal', 'Peringatan', 'Jumlah penarikan harus angka positif yang valid.');
            return;
        }

        // Periksa saldo sebelum mengirim ke Edge Function
        if (jumlah > currentSaldo) {
            showModal('alert-modal', 'Saldo Tidak Cukup', `Saldo Anda saat ini Rp.${currentSaldo.toLocaleString('id-ID')}. Jumlah penarikan melebihi saldo.`);
            return;
        }

        // Contoh minimum withdrawal amount (sesuaikan jika perlu)
        const MIN_WITHDRAWAL_AMOUNT = 10000;
        if (jumlah < MIN_WITHDRAWAL_AMOUNT) {
            showModal('alert-modal', 'Penarikan Minimum', `Jumlah penarikan minimal adalah Rp.${MIN_WITHDRAWAL_AMOUNT.toLocaleString('id-ID')}.`);
            return;
        }

        // Prepare bank account info for the Edge Function
        const bankAccountInfo = {
            bank_name: (metode === 'Bank' && bank) ? bank : metode, // Use bank name if method is 'Bank', else use method itself (e.g., 'DANA', 'OVO')
            account_number: nomor,
            account_holder: nama,
            email: email // Menggunakan nilai email yang sudah di-trim
        };

        // --- Logging Data untuk Debugging ---
        console.log("Data yang akan dikirim ke Edge Function:");
        console.log("Amount:", jumlah);
        console.log("Bank Account Info:", bankAccountInfo);
        console.log("Full Request Body JSON:", JSON.stringify({ amount: jumlah, bank_account_info: bankAccountInfo }));

        const withdrawTableBody = document.querySelector('#riwayat-penarikan-modal tbody');
        const now = new Date();
        const dateString = now.toLocaleString('id-ID');
        const tempId = `temp-${Date.now()}`;
        const newRowHTML = `<tr class="pending-item" data-id="${tempId}"><td>${dateString}</td><td>Rp${jumlah.toLocaleString('id-ID')}</td><td class="status-pending">Pending</td></tr>`;

        if (withdrawTableBody.querySelector('.empty')) {
            withdrawTableBody.innerHTML = '';
        }
        withdrawTableBody.insertAdjacentHTML('afterbegin', newRowHTML);

        // Add loading state
        submitButton.classList.add('loading');
        submitButton.disabled = true;

        try {
            // Get current user session for authentication token
            const session = await supabase.auth.getSession();
            if (!session.data.session) {
                showModal('alert-modal', 'Sesi Tidak Valid', 'Sesi pengguna tidak valid. Silakan login kembali.');
                const tempRow = withdrawTableBody.querySelector(`[data-id="${tempId}"]`);
                if (tempRow) { tempRow.remove(); }
                throw new Error('No active session.');
            }
            const accessToken = session.data.session.access_token;

            const edgeFunctionUrl = `${SUPABASE_URL}/functions/v1/processed_withdrawal`;

            const response = await fetch(edgeFunctionUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${accessToken}`
                },
                body: JSON.stringify({
                    amount: jumlah,
                    bank_account_info: bankAccountInfo
                })
            });

            // --- Penanganan Respons dari Edge Function ---
            if (!response.ok) { // Jika status HTTP bukan 2xx (misal 400, 500)
                const errorResponseText = await response.text(); // Baca respons sebagai teks mentah
                console.error("HTTP Error response from Edge Function (status " + response.status + "):", errorResponseText);

                let errorMessage = 'Terjadi kesalahan tidak dikenal saat memproses penarikan.';
                try {
                    const errorData = JSON.parse(errorResponseText);
                    // Coba ambil pesan dari body JSON jika ada
                    errorMessage = errorData.message || errorMessage;
                } catch (parseError) {
                    // Jika respons bukan JSON valid, gunakan teks mentah sebagai pesan error
                    console.warn("Failed to parse error response as JSON. Using raw text.");
                    errorMessage = `Server Error: ${errorResponseText.substring(0, 150)}...`; // Potong agar tidak terlalu panjang
                }
                showModal('error-modal', 'Gagal!', errorMessage);
                const tempRow = withdrawTableBody.querySelector(`[data-id="${tempId}"]`);
                if (tempRow) { tempRow.remove(); }
                return; // Penting: Hentikan eksekusi di sini jika ada error HTTP
            }

            const data = await response.json(); // Parse respons JSON dari Edge Function jika status OK

            if (data.message) {
                showModal('success-modal', 'Berhasil!', data.message);
                closeModal('modal-withdraw');
                // Update saldo display dengan saldo baru yang dikembalikan oleh Edge Function
                if (data.new_saldo !== undefined) {
                    currentSaldo = data.new_saldo;
                    document.getElementById('saldo-display').textContent = `Saldo: Rp.${currentSaldo.toLocaleString('id-ID')}`;
                } else {
                    // Fallback: jika new_saldo tidak ada di respons, refresh profile untuk mendapatkan saldo terbaru
                    await loadProfile();
                }
                await loadHistory('riwayat-penarikan-modal', 'withdraw_requests'); // Refresh withdrawal history
            } else {
                // Jika respons OK tapi tidak ada message sukses (jarang, tapi jaga-jaga)
                showModal('error-modal', 'Gagal!', 'Permintaan berhasil dikirim, tetapi tidak ada konfirmasi yang jelas.');
                const tempRow = withdrawTableBody.querySelector(`[data-id="${tempId}"]`);
                if (tempRow) { tempRow.remove(); }
            }

        } catch (error) {
            console.error('Error saat memanggil API penarikan:', error);
            showModal('error-modal', 'Error Jaringan', 'Gagal terhubung ke server. Silakan coba lagi. Detail: ' + error.message);
            const tempRow = withdrawTableBody.querySelector(`[data-id="${tempId}"]`);
            if (tempRow) { tempRow.remove(); }
        } finally {
            // Selalu hapus loading state dan aktifkan kembali tombol
            submitButton.classList.remove('loading');
            submitButton.disabled = false;
        }
    };


    // History button logic
    document.getElementById('btn-history').onclick = async () => {
        if (!uid) { showModal('alert-modal', 'Login Diperlukan', 'Anda harus login untuk melihat riwayat transaksi.'); return; }
        showModal('modal-history');
        await loadHistory('riwayat-deposit-modal', 'deposit_requests');
        await loadHistory('riwayat-penarikan-modal', 'withdraw_requests');
    };

    // Game list data
    const games = [
        { name: 'SLOT 77', url: 'slot.html', imageUrl: 'https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//Slot77.jpeg' },
        { name: 'POKER', url: 'poker1.html', imageUrl: 'https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//download.jpeg' },
        { name: 'TEBAK DADU', url: 'tebakdadu.html', imageUrl: 'https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//tebakdadu%20(1).png' },
        { name: 'SAMGONG', url: 'samgong1.html', imageUrl: 'https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//unnamed.png' },
        { name: 'SUSUN BALOK', url: 'susunbalok99.html', imageUrl: 'https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//images%20(2).jpeg' },
        { name: 'QIU QIU', url: 'qiu99.html', imageUrl: 'https://vqmfachxnjyxwuavpgds.supabase.co/storage/v1/object/public/zaus//download%20(4).jpeg' },
        { name: 'QIU QIU', url: 'qiu99.html', imageUrl: '***' },
        { name: 'QIU QIU', url: 'qiu99.html', imageUrl: '***' },
        { name: 'QIU QIU', url: 'qiu99.html', imageUrl: '***' },
        { name: 'QIU QIU', url: 'qiu99.html', imageUrl: '****' },
        { name: 'QIU QIU', url: 'qiu99.html', imageUrl: '***' },
        { name: 'QIU QIU', url: 'qiu99.html', imageUrl: '***' },
    ];

    // Load game list into display grid
    function loadGames() {
        const gameGridContainer = document.getElementById('game-display-grid');
        gameGridContainer.innerHTML = '';
        games.forEach(game => {
            const gameItem = document.createElement('div');
            gameItem.classList.add('game-item');
            gameItem.innerHTML = `
                <a href="${game.url}">
                    <img src="${game.imageUrl}" alt="${game.name}">
                </a>
            `;
            gameGridContainer.appendChild(gameItem);
        });
    }

</script>
</body>
</html>
